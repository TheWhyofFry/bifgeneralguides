<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.26-DEV" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />

    <title>Prepping Phylogenetic Data With BASH :: General BIF guides</title>
    
    
    <link href="/bifgeneralguides/css/nucleus.css?1509465003" rel="stylesheet">
    <link href="/bifgeneralguides/css/font-awesome.min.css?1509465003" rel="stylesheet">
    <link href="/bifgeneralguides/css/hybrid.css?1509465003" rel="stylesheet">
    <link href="/bifgeneralguides/css/featherlight.min.css?1509465003" rel="stylesheet">
    <link href="/bifgeneralguides/css/perfect-scrollbar.min.css?1509465003" rel="stylesheet">
    <link href="/bifgeneralguides/css/horsey.css?1509465003" rel="stylesheet">
    <link href="/bifgeneralguides/css/theme.css?1509465003" rel="stylesheet">
    <link href="/bifgeneralguides/css/hugo-theme.css?1509465003" rel="stylesheet">
    

    <script src="/bifgeneralguides/js/jquery-2.x.min.js?1509465003"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/bifgeneralguides/bash/bashphylo/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://getgrav.org">
  <svg id="grav-logo" width="100%" height="100%" viewBox="0 0 504 140" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">
    <path d="M235.832,71.564l-7.98,-0.001c-1.213,0.001 -2.197,0.987 -2.197,2.204l0,15.327l-0.158,0.132c-4.696,3.962 -10.634,6.14 -16.719,6.14c-14.356,0 -26.034,-11.68 -26.034,-26.037c0,-14.358 11.678,-26.035 26.034,-26.035c5.582,0 10.919,1.767 15.437,5.113c0.877,0.649 2.093,0.56 2.866,-0.211l5.69,-5.69c0.444,-0.442 0.675,-1.055 0.639,-1.681c-0.034,-0.627 -0.336,-1.206 -0.828,-1.597c-6.76,-5.363 -15.214,-8.314 -23.805,-8.314c-21.18,0 -38.414,17.233 -38.414,38.415c0,21.183 17.234,38.415 38.414,38.415c10.937,0 21.397,-4.705 28.698,-12.914c0.358,-0.403 0.556,-0.921 0.556,-1.46l0,-19.603c0,-1.217 -0.985,-2.203 -2.2,-2.203"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M502.794,34.445c-0.408,-0.616 -1.1,-0.989 -1.838,-0.989l-8.684,0c-0.879,0 -1.673,0.522 -2.022,1.329l-24.483,56.839l-24.92,-56.852c-0.352,-0.799 -1.142,-1.316 -2.012,-1.316l-8.713,0c-0.744,0 -1.44,0.373 -1.843,0.995c-0.408,0.623 -0.476,1.408 -0.174,2.09l30.186,68.858c0.352,0.799 1.143,1.317 2.017,1.317l10.992,0c0.879,0 1.673,-0.527 2.021,-1.329l29.655,-68.861c0.289,-0.68 0.222,-1.461 -0.182,-2.081"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M388.683,34.772c-0.353,-0.798 -1.142,-1.316 -2.017,-1.316l-10.988,0c-0.879,0 -1.673,0.522 -2.021,1.329l-29.655,68.861c-0.294,0.675 -0.226,1.46 0.182,2.077c0.407,0.619 1.096,0.993 1.838,0.993l8.684,0c0.879,0 1.673,-0.526 2.022,-1.329l24.478,-56.842l24.92,56.854c0.353,0.798 1.143,1.317 2.013,1.317l8.717,0c0.744,0 1.44,-0.374 1.843,-0.993c0.408,-0.624 0.471,-1.41 0.174,-2.094l-30.19,-68.857Z"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M309.196,81.525l0.476,-0.229c8.675,-4.191 14.279,-13.087 14.279,-22.667c0,-13.881 -11.295,-25.174 -25.176,-25.174l-31.863,0c-1.214,0 -2.199,0.988 -2.199,2.202l0,68.855c0,1.219 0.985,2.204 2.199,2.204l7.979,0c1.214,0 2.2,-0.985 2.2,-2.204l0,-58.679l21.684,0c7.059,0 12.799,5.739 12.799,12.796c0,5.885 -3.996,10.989 -9.728,12.408c-1.032,0.261 -2.064,0.393 -3.071,0.393l-7.977,0c-0.829,0 -1.585,0.467 -1.959,1.205c-0.378,0.74 -0.305,1.625 0.187,2.296l22.62,30.884c0.412,0.566 1.07,0.901 1.771,0.901l9.915,0c0.827,0 1.587,-0.467 1.96,-1.207c0.378,-0.742 0.302,-1.629 -0.186,-2.296l-15.91,-21.688Z"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M107.191,80.969c-7.255,-4.794 -11.4,-8.845 -15.011,-16.109c-2.47,4.977 -8.236,12.376 -17.962,18.198c-4.856,15.106 -27.954,44.015 -35.43,39.916c-2.213,-1.212 -2.633,-2.808 -2.133,-4.456c0.536,-4.129 9.078,-13.62 9.078,-13.62c0,0 0.18,1.992 2.913,6.187c-3.609,-11.205 5.965,-25.031 8.5,-29.738c3.985,-1.269 4.274,-6.387 4.274,-6.387c0.255,-7.909 -3.278,-13.635 -6.701,-17.059c2.459,3.002 3.255,7.539 3.372,11.694l0,0.023c0.012,0.469 0.012,0.93 0.011,1.39c-0.117,3.439 -1.157,8.19 -3.383,8.19l0.006,0.03c-2.289,-0.098 -5.115,0.391 -7.639,1.18l-5.582,1.334c0,0 2.977,-0.136 4.584,1.252c-1.79,2.915 -5.769,6.533 -10.206,8.588c-6.457,2.995 -8.312,-2.964 -5.034,-6.838c0.805,-0.946 1.618,-1.745 2.387,-2.399c-0.495,-0.513 -0.807,-1.198 -0.889,-2.068c-0.001,-0.005 -0.004,-0.009 -0.005,-0.013c-0.45,-1.977 -0.202,-4.543 2.596,-8.623c0.551,-0.863 1.214,-1.748 2.007,-2.647c0.025,-0.031 0.046,-0.059 0.072,-0.089c0.034,-0.042 0.072,-0.08 0.108,-0.121c0.02,-0.023 0.039,-0.045 0.059,-0.068c0.2,-0.228 0.413,-0.45 0.639,-0.663c3.334,-3.414 8.599,-6.966 16.897,-10.152c9.675,-14.223 13.219,-16.89 13.219,-16.89c1.071,-1.096 2.943,-2.458 3.632,-2.805c-5.053,-8.781 -6.074,-21.158 -4.75,-24.493c-0.107,0.18 -0.206,0.365 -0.287,0.556c0.49,-1.143 0.819,-1.509 1.328,-2.111c1.381,-1.632 6.058,-2.488 7.737,0.971c0.895,1.844 1.063,4.232 1.034,6.023c-3.704,-0.193 -7.063,4.036 -7.063,4.036c0,0 3.067,-1.448 6.879,-1.473c0,0 1.015,0.883 2.283,2.542c-1.712,3.213 -4.524,10.021 -2.488,17.168c0.338,1.408 0.849,2.619 1.483,3.648c0.024,0.045 0.044,0.089 0.069,0.135c0.051,0.066 0.096,0.122 0.144,0.183c3.368,5.072 9.542,5.665 9.542,5.665c-2.906,-1.45 -5.274,-3.76 -6.816,-6.56c-0.8,-1.498 -1.291,-2.762 -1.592,-3.761c-1.636,-6.313 0.771,-9.999 2.149,-12.471c3.17,-4.917 8.944,-7.893 15.151,-7.185c8.712,0.995 14.968,8.862 13.973,17.571c-0.608,5.321 -3.781,9.723 -8.142,12.117c1.049,2.839 -0.073,6.28 -0.073,6.28c2.642,3.323 2.758,5.238 2.667,7.017c-3.357,-0.565 -6.618,1.701 -6.618,1.701c0,0 6.476,-1.546 10.238,1.81c2.446,2.631 4.078,5.009 5.051,6.766c1.393,2.505 7.859,2.683 7.123,7.188c-0.737,4.499 -5.669,4.542 -13.401,-0.56M69.571,0c-38.424,0 -69.571,31.148 -69.571,69.567c0,38.422 31.147,69.573 69.571,69.573c38.42,0 69.568,-31.151 69.568,-69.573c0,-38.42 -31.148,-69.567 -69.568,-69.567"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M73.796,51.693c0.813,-0.814 0.813,-2.134 0,-2.947c-0.815,-0.814 -2.133,-0.814 -2.947,0c-0.815,0.813 -0.815,2.133 0,2.947c0.814,0.813 2.132,0.813 2.947,0" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M66.445,53.149c-0.814,0.813 -0.814,2.133 0,2.947c0.813,0.814 2.133,0.814 2.947,0c0.813,-0.814 0.813,-2.134 0,-2.947c-0.814,-0.813 -2.134,-0.813 -2.947,0" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M79.231,54.233c-1.274,-1.274 -3.339,-1.272 -4.611,0l-2.713,2.712c-1.274,1.275 -1.274,3.339 0,4.612l2.978,2.978c1.274,1.275 3.338,1.274 4.611,0l2.712,-2.712c1.274,-1.274 1.274,-3.339 0,-4.612l-2.977,-2.978Z" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M95.759,41.445c-2.151,-2.578 1.869,-7.257 4.391,-4.463c4.645,5.148 -2.237,7.041 -4.391,4.463M105.004,44.132c3.442,-6.553 -1.427,-10.381 -4.773,-13.523c-5.36,-5.039 -10.706,-7.217 -16.811,-0.241c-6.102,6.977 -2.226,15.068 3.356,19.061c5.584,3.994 14.782,1.255 18.228,-5.297"
      style="fill:#000;fill-rule:nonzero;"></path>
  </svg>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/bifgeneralguides/js/lunr.min.js?1509465003"></script>
<script type="text/javascript" src="/bifgeneralguides/js/horsey.js?1509465003"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/thewhyoffry.github.io\/bifgeneralguides";
    
</script>
<script type="text/javascript" src="/bifgeneralguides/js/search.js?1509465003"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/bifgeneralguides/bash/" title="Bashes" class="dd-item 
        parent
        
        
        ">
      <a href="/bifgeneralguides/bash/">
          Bashes
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/bifgeneralguides/bash/bashphylo/" title="Prepping Phylogenetic Data With BASH" class="dd-item active">
        <a href="/bifgeneralguides/bash/bashphylo/">
        Prepping Phylogenetic Data With BASH
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/bifgeneralguides/bash/_intro/" title="BASH" class="dd-item ">
        <a href="/bifgeneralguides/bash/_intro/">
        BASH
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/bifgeneralguides/introduction/" title="_index" class="dd-item 
        
        
        
        ">
      <a href="/bifgeneralguides/introduction/">
          _index
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/bifgeneralguides/introduction/welcome/" title="Welcome" class="dd-item ">
        <a href="/bifgeneralguides/introduction/welcome/">
        Welcome
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable sticky-parent">
              
              <div class="sticky-spacer">
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/bifgeneralguides/'>General BIF guides</a> > <a href='/bifgeneralguides/bash/'>Bashes</a> > Prepping Phylogenetic Data With BASH
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#manipulating-variables">Manipulating variables</a></li>
<li><a href="#for-loops">For loops</a></li>
<li><a href="#how-to-run-this-loop">How to run this loop</a></li>
<li><a href="#before-we-move-on">Before we move on</a>
<ul>
<li><a href="#an-alternative-renaming-scheme">An alternative &ldquo;renaming&rdquo; scheme</a></li>
</ul></li>
<li><a href="#something-doesn-t-work">Something doesn&rsquo;t work</a></li>
</ul></li>
<li><a href="#an-exercise">An exercise</a>
<ul>
<li><a href="#generating-a-concatenated-model-file">Generating a concatenated model file</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Prepping Phylogenetic Data With BASH</h1>
          

        



<h2 id="introduction">Introduction</h2>

<p>General usage of shell environments are restricted to executing simple commands to complete tasks. So</p>

<p>Some of the previous demonstrations have shown additional functionality provided by default in the
shell environment. For instance, you were shown that it was not necessary to copy-paste/retype full
pathnames. You can use a shell variable to reference said pathname.</p>

<pre><code class="language-bash">MYDATAFOLDER=/mnt/lustre/users/username/data/myinputdata


#Full path
samtools stats /mnt/lustre/users/username/data/myinputdata/something.bam

#Variable

samtools stats ${MYDATAFOLDER}/something.bam
</code></pre>

<p>This is a very trivial example, but still very useful to keep things tidy.  It&rsquo;s easy to get lost.
Besides aesthetics, the use of a <em>variable</em> is exceptionally useful.  We can use them to store
output from another command. Let&rsquo;s say you want to keep a collection of all the fasta files in a
current directory.</p>

<pre><code class="language-bash">ls *.fasta # our command, just to check
1.fasta 2.fasta 3.fasta # etc

MYFASTAFILES=$(ls *.fasta)

echo ${MYFASTAFILES}

</code></pre>

<p>Let&rsquo;s break this down a bit.  First, how do we define a variable and do we access the value of a
variable?  We define a variable as <code>VARIABLENAME=SOMEVALUE</code>.  Where <code>VARIABLENAME</code> can be any
abitrary name that (I think) has to start with an non-numeric normal character. The <code>SOMEVALUE</code>
part can be a number, <code>VARIABLENAME=5</code>, a string (a string is a sequence of characters),
<code>VARIABLENAME=&quot;Goody bash&quot;</code>, or the output of a command. For the last part, we can <em>capture</em>
command output by wrapping the command in <code>$()</code> (Note, some guides will tell you that you can
also use backicks, <code>`</code>, but this is deprecated in favour of <code>$()</code>). So the output you see when
you type <code>ls *.fasta</code> is now <em>redirected</em> to the variable when you encapsulate as<code>$(ls
*.fasta)</code>.</p>

<h3 id="manipulating-variables">Manipulating variables</h3>

<p>Variables are by definition not static entities and can easily be changed to something else.
Indeed, by using the expression <code>${MYDATAFOLDER}/something.bam</code>, you are creating a new (unnnamed)
variable that combines the value of <code>MYDATAFOLDER</code> and <code>/something.bam</code>. Values of variables can
be manipulated in interesting ways.  A lot of time  when dealing with many data files, you&rsquo;ll sit
with a situation where manual grouping of data according to sample/group/etc becomes really
difficult.</p>

<p>Take a look at the following filenames:</p>

<pre><code>036-2012P_S1.out
036-2024P_S2.out
036-2036P_S3.out
039-2002-0_S61.out
079-2003-5_S62.out
079-2004P_S5.out
079-2012P_S6.out
079-2024P_S7.out
079-2036P_S8.out
079-2036_S3.out
093-2001_S2.out
093-2002P_S10.out
093-2002_S4.out
093-2004P_S11.out
093-2012-0_S63.out
093-2012P_S12.out
093-2024-0_S64.out
093-2024P_S13.out
093-2036P_S14.out
102-2002-0_S65.out
102-2004P_S15.out
102-2012-0_S66.out
102-2012P_S16.out
102-2012_S5.out
102-2024-0_S67.out
102-2024P_S17.out
102-2036-0_S68.out
102-2048P_S19.out

</code></pre>

<p>The format of each filename is:</p>

<pre><code>  036  -  2012P _   S1     .out
(group)-(sample)_(sampleid).(ext)
</code></pre>

<p>I would like to organize these files by moving all the files belogning to the same group into a new
folder.  I would like this folder to be named according to the group name.  Furthermore, the
filenames should only contain the sample name (without sample id) and a different extension, &ldquo;.txt&rdquo;.</p>

<pre><code>036-2012P_S1.out --&gt; 036/2012P.txt
</code></pre>

<p>How remove everything after the group number? We know that the group number is always followed by a
dash (<code>-</code>).  There are actually multiple ways of doing this.  The <code>cut</code> command allows you to
extract columns from text files, given a delimeter (separator).  So we could technically use the dash as the
delimiter and extact the first column:</p>

<pre><code class="language-bash">echo &quot;036-2012P_S1.out&quot; | cut -f 1 -d\-
036

#Store it

GROUPNAME=$(echo &quot;036-2012P_S1.out&quot; | cut -f 1 -d\-)
echo ${GROUPNAME}
036
</code></pre>

<p>But it&rsquo;s quite cumbersome to do this, not to mention inefficient.  For every file, we need to use
the &ldquo;cut&rdquo; just to get the prefix of a file (which is the group in this case). Alternative, we could
use built in BASH string substitution commands.  To remove a suffix, an implicitly be left with a
prefix:</p>

<pre><code class="language-bash">${VARIABLE%%[pattern]}

FILENAME=&quot;036-2012P_S1.out&quot;
GROUPNAME=${FILENAME%%-*}

echo ${GROUPNAME}
036

</code></pre>

<p>The <code>%</code> operator tell BASH to remove everything after and including that which matches
<code>[pattern]</code>.  The pattern in this case is the first dash and <em>everything</em> after that. If you were
to play around with the command a bit, you&rsquo;d see the following:</p>

<pre><code>echo ${FILENAME%1*} # Remove everything after the last occurrence of &quot;1&quot;
036-2012P_S

echo ${FILENAME%%1*} # Remove everything after the first occurrence of &quot;1&quot;
</code></pre>

<p>The command may seem a little confusing, but fret not.  The search for a pattern actually starts
from the end of the line.  A single <code>%</code> indicates that everything gets deleted from the end of the
string up to the <em>first</em> match.  A double <code>%%</code> indicates that everything gets deleted up to the
final match starting from the end of the line.</p>

<p>So now we know how to generate the group name.  Next, we need to extract the sample name.  We need
to remove the <code>group prefix</code> and everything from the <code>sample id</code> onward.  Then add the <code>.txt</code>
extension.</p>

<pre><code class="language-bash">
SUFFIX=${FILENAME#*-}
echo ${SUFFIX}
2012P_S1.out

SAMPLE=${SUFFIX%%_*}

echo ${SAMPLE}
2012P

</code></pre>

<p>So the <code>#</code> operator removes everything before and including a match.  The example above removed
everything up to and including the first &ldquo;-&rdquo;.  However, we still need to remove the trailing bits,
so the following command assigns the <code>SAMPLE</code> variable as the <code>SUFFIX</code> variable minus the pesky
suffix, i.e. <code>_S1.out</code>.</p>

<p>Finally, we can construct the desired filename:</p>

<pre><code class="language-bash">
FINALNAME=${GROUPNAME}/${SAMPLE}.txt

echo ${FINALNAME}
</code></pre>

<p>Great, but how do we put this all together? We still have many files to go through and it would be a
bit slow to do this procedure for every single filename manually.  We can use loops</p>

<h3 id="for-loops">For loops</h3>

<p>For loops are loops that go through items in some sort of list.  With each iteration, this item
grabbed from the list can be used in whatever way you see fit.  We&rsquo;ll loop through the files in our
directory.</p>

<pre><code class="language-bash">
for file in *.out
	do 
		FILENAME=$(basename ${file}) # removes the path - not really needed here
		GROUPNAME=${FILENAME%%-*}
		SUFFIX=${FILENAME#*-}
		SAMPLE=${SUFFIX%%_*}
		FINALNAME=${GROUPNAME}/${SAMPLE}.txt

		echo &quot;mkdir -p out/${GROUPNAME}; cp ${file} out/${FINALNAME}&quot;
	done
</code></pre>

<p>Let&rsquo;s look at the anatomy of a <code>for loop</code>:</p>

<ol>
<li>The first line of the for loop here sets up what to loop through and where to store the value
after each iteration.  So for each <code>file</code> in <code>*.out</code> means for each <em>filename</em> matching the
pattern <code>*.out</code>, i.e. all files ending with <code>*.out</code> in the current directory.  An equivalent
command would be <code>for file in $(ls *.out)</code>. Each filename will then be passed to <code>file</code>.</li>
<li>The <code>do</code> and <code>done</code> words mark the beginning and end of the content part of the loop. And
everything between the two words will be executed as long as there are more <code>*.out</code> files to
go through.<br /></li>
<li>Disregarding the content between the <code>do</code> and <code>done</code> parts, if this loop were to run, and
the files <code>one.out</code>, <code>two.out</code> and <code>three.out</code> existed in the current folder, the value of
<code>file</code> would be <code>one.out</code> first, and when the loop restarts, <code>two.out</code> and finally
<code>three.out</code> after which the loop will end. And code (if any) below the for loop will be
executed.</li>
<li>The main content of the loop:

<ol>
<li><code>FILENAME=$(basename ${file})</code> - In this example, this step is not really necessary,
but we would rather like the <em>basename</em> of a file. The <em>basename</em> is the filename without
a prefixed path, e.g. <code>basename /mnt/your/file.txt</code> becomes <code>file.txt</code>. By using
round brackets and a <code>$</code>, the output of the basename command is then stored in the
FILENAME variable.</li>
<li><code>GROUPNAME=${FILENAME%%-*}</code> - As mentioned before, we would like the first part of the
filename to be used as the assigned group. The <code>%%</code> means remove everything, including
the pattern following <code>%%</code>, i.e. the first occurrence of <code>-</code> up to the end of the
string. So &ldquo;0123-12312_&hellip;.&rdquo; becomes &ldquo;0123&rdquo;, &ldquo;ABCDEF-12345-6789&rdquo; becomes &ldquo;ABCDEF&rdquo; and so
on. This search is performed left to right, so it will greedily (as denoted by <code>%%</code>)
remove the pattern matched up until the last match.</li>
<li><code>SUFFIX=${FILENAME#*-}</code> - Remove the <em>group name</em> prefix from the filename. This
search is performed from left to right, and will only remove up to the first occurrence
of the pattern.  In this case, &ldquo;ABCDEF-12345-6789&rdquo; will become &ldquo;12345-6789&rdquo;.  How would
this change if the pattern matching was done greedily, i.e. &ldquo;${FILENAME##*-}&ldquo;?</li>
<li><code>SAMPLE=${SUFFIX%%_*}</code> - As for group name, remove everything after the sample name part.</li>
<li><code>FINALNAME=${GROUPNAME}/${SAMPLE}.txt</code> - Concatenate the <em>group name</em> and the <em>sample
name</em>.  This is what our final name should look like.  It will be put under the <em>group
name</em> path with the <em>sample name</em> as the final filename.</li>
<li><code>echo &quot;mkdir -p out/${GROUPNAME}; cp ${file} out/${FINALNAME}&quot;</code> - This command won&rsquo;t
actuall make the path and copy the file name to its new name.  It will only print the
command to screen.  Personally, I do this before actually executing the command to make
sure I didn&rsquo;t mess up.  The final command would first make a directory with the &ldquo;mkdir&rdquo;
command. The semicolor &ldquo;;&rdquo; indicates that a new command follows it, which is &ldquo;cp&rdquo; in this
case.</li>
</ol></li>
<li>This loop continues until there are no more files to analyze.</li>
</ol>

<div class="notices warning" ><p>Remember to include the parameters of <em>echo</em> in quotes.  If you remove the quites, the following
will happen (using the filename &ldquo;036-2012P_S1.out&rdquo; as an example):</p>

<blockquote>
<pre><code>echo mkdir -p out/036
mkdir -p out/036
</code></pre>

<pre><code>cp 036-2012P_S1.out out/2012P.txt
No such file: out (or something similar)
</code></pre>
</blockquote>

<p>This is because the &ldquo;;&rdquo; will tell bash that the current command (echo) ends here and that a new
command is executed.  Putting everything in quotes ensures that the entire line is only printed to
screen.</p>
</div>


<p>It is important to make sure that the command you executed works well.  Indeed, if we run this loop,
we&rsquo;ll notice the following:</p>

<pre><code>mkdir -p out/568; cp 568-2001-0_S89.out out/568/2001-0.txt
                                                   ^^^
</code></pre>

<p>So this has to do with the <code>SAMPLENAME</code> variable.  So it seems we need to look for an <code>_</code> and a
<code>-</code>.  Change the <code>SAMPLE=${SUFFIX%%_*}</code> line to <code>SAMPLE=${SUFFIX%%[_-]*</code>. The block brackets
say that the pattern can match either <code>-</code> or <code>_</code> in the beginning.</p>

<pre><code class="language-bash">
for file in *.out
	do 
		FILENAME=$(basename ${file}) # removes the path - not really needed here
		GROUPNAME=${FILENAME%%-*}
		SUFFIX=${FILENAME#*-}
		SAMPLE=${SUFFIX%%[_-]*}
		FINALNAME=${GROUPNAME}/${SAMPLE}.txt

		echo &quot;mkdir -p out/${GROUPNAME}; cp ${file} out/${FINALNAME}&quot;
	done
</code></pre>

<p>And this produces a much better output</p>

<pre><code>
mkdir -p out/036; cp 036-2012P_S1.out out/036/2012P.txt
mkdir -p out/036; cp 036-2024P_S2.out out/036/2024P.txt
mkdir -p out/036; cp 036-2036P_S3.out out/036/2036P.txt
mkdir -p out/039; cp 039-2002-0_S61.out out/039/2002.txt
mkdir -p out/079; cp 079-2003-5_S62.out out/079/2003.txt
mkdir -p out/079; cp 079-2004P_S5.out out/079/2004P.txt
mkdir -p out/079; cp 079-2012P_S6.out out/079/2012P.txt
mkdir -p out/079; cp 079-2024P_S7.out out/079/2024P.txt
mkdir -p out/079; cp 079-2036P_S8.out out/079/2036P.txt
mkdir -p out/079; cp 079-2036_S3.out out/079/2036.txt
mkdir -p out/093; cp 093-2001_S2.out out/093/2001.txt
mkdir -p out/093; cp 093-2002P_S10.out out/093/2002P.txt
mkdir -p out/093; cp 093-2002_S4.out out/093/2002.txt
mkdir -p out/093; cp 093-2004P_S11.out out/093/2004P.txt
mkdir -p out/093; cp 093-2012-0_S63.out out/093/2012.txt
mkdir -p out/093; cp 093-2012P_S12.out out/093/2012P.txt
mkdir -p out/093; cp 093-2024-0_S64.out out/093/2024.txt
mkdir -p out/093; cp 093-2024P_S13.out out/093/2024P.txt
</code></pre>

<h3 id="how-to-run-this-loop">How to run this loop</h3>

<p>You can enter the loop in a terminal as-is.  But it is generally better to put everything into a
file, say <code>renamescript.bash</code> and then execute it with <code>bash renamescript.bash</code>.  As an aside,
you can add the following to the very beginning of the file:</p>

<pre><code>#!/bin/bash
</code></pre>

<p>And then, in the folder containing the script, type:</p>

<pre><code>chmod a+x renamescript.bash
</code></pre>

<p>However, if you&rsquo;re using git bash, I&rsquo;m unsure what the behaviour would be, so perhaps better to use
the <code>bash renamescript.bash</code> command. If this doesn&rsquo;t work, try <code>source renamescript.bash</code>.</p>

<h3 id="before-we-move-on">Before we move on</h3>

<h4 id="an-alternative-renaming-scheme">An alternative &ldquo;renaming&rdquo; scheme</h4>

<p>Of course, instead of copying the file as a new filename, we could just make symbolic links.
Symbolic links act as a placeholder and references to the original filename.  To do it this way, we
replace the &ldquo;echo&rdquo; line:</p>

<pre><code>echo &quot;mkdir -p out/${GROUPNAME}; cp ${file} out/${FILENAME}&quot;

#Replace this with:

echo &quot;mkdir -p out/${GROUPNAME}; ln -s ${file} out/${FILENAME}&quot;

#If the original files won't be moved, we can use absolute paths, since these will give relative
paths:

echo &quot;mkdir -p out/${GROUPNAME}; ln -s $(realpath ${file}) out/${FILENAME}&quot;
</code></pre>

<p>The <code>realpath</code> command gives the <em>absolute path</em> of the filename, i.e. something in
&ldquo;/mnt/user/data/something&rdquo; is just referred to as &ldquo;something&rdquo; by default, while using <code>realpath
samplename</code> will give you &ldquo;/mnt/user/data/something&rdquo;.</p>

<h3 id="something-doesn-t-work">Something doesn&rsquo;t work</h3>

<p>It happens :-) In this example, I&rsquo;m fairly certain that the main mistakes you&rsquo;d make would be:</p>

<ol>
<li>Forgetting the difference between <code>$()</code> and <code>${}</code>. The <code>$()</code> means &ldquo;please use the output
from program X as a value, while the <code>${}</code> means &ldquo;please use the value of the variable between
<code>{}</code>.</li>
<li>Forgetting your quotes after &ldquo;echo&rdquo;. See the previous paragraphs.</li>
<li>Seeing an annoying <code>&gt;</code> that doesn&rsquo;t seem to go away.  Check if your for loop has a <code>do</code> and
<code>done</code> part.  The <code>&gt;</code> means that BASH is either expecting more input (e.g. type <code>&quot;</code> and
enter on a line) or that it is still within a &ldquo;block&rdquo; such as an unterminated for loop.</li>
</ol>

<h2 id="an-exercise">An exercise</h2>

<p>Hopefully you understand, at least in principle, what was discussed in the previous section.  If you
are unsure about something, read it again. If you still don&rsquo;t understand, then my explanation has
failed you and you are welcome to do a quick web search on the topic - and please spread the word.</p>

<p>For newcomers and even intermediate users, the following exercise (namesake of the title) may seem a
bit challenging at first. This is something I had to personally do.  It is quite a fun exercise when
you get it right. Bioinformatics, like most things in science, is about abstracting a problem and
then pooling together the necessary tools to reach a goal.  Bear with me, it has something to do
with phylogenetics, &ndash;phylogenomics more specifically&ndash; (nope, I don&rsquo;t want to lose you already).<br />
  I will describe the general nature of the problem, so you can see where we&rsquo;re heading with it and then
give you a task to complete.  For each step, the answers will be hidden to you, but you are allowed
to sneak a peak. Try to do this only if you are really stuck.</p>

<h3 id="generating-a-concatenated-model-file">Generating a concatenated model file</h3>

<p>Phylogenetics is used to find the relationship between sequences.  A phylogenetic tree might give
you information on the evolutionary history and/or grouping of sequences.  An example would be using
hox genes to do large evolutionary classifications.  A phylogeny is based on the topology of a tree
and the branches.  I won&rsquo;t go into too much detail (and omitting quite a bit in the process), but the branch lengths indicate how &ldquo;far&rdquo; a
sequence is to the common ancestor of its neighbour.  The sequences together with a model can be
used to find this optimal branch length and topology.  To do a general comparison between organisms,
select sequences are used and a combined phylogeny is created.  However, different sequences evolve
at different rates and according to different substitution models.
  I have a set of ~1400 sequences for which I have determined the optimal substitution model.  What
  I need now, is a file that contains the sequence name and the appropriate model.  An example of
  the output:</p>

<pre><code>100.fas,LG4X
101.fas,JTT+G
200.fas,JTT
</code></pre>

<p>So the output needs to be of a &ldquo;CSV&rdquo; (comma separated value) nature.  In loose terms, a sort of
spread sheet. The first column needs to have the appropriate FASTA file, while the second column
will contain the best model for making a phylogenetic inference.</p>

<p>If you look at the <code>model</code> folder in the example data, you will see there are ~1400 files. Each of
them have a &ldquo;.mod&rdquo; extension.  Within this file, there is a specific line that determines the best
model for the sequences at hand.  The line we would like to use, is:</p>

<pre><code>The best model according to AIC: JTT
</code></pre>

<p>To get this line, we can use the <code>grep</code> command.  The <code>grep</code> command will print lines in a file
matching a pattern you specify.  So if you are in the <code>model</code> folder, you can type:</p>

<pre><code class="language-bash">grep &quot;The best model according to AIC&quot; 100.mod
</code></pre>

<p>And it will give you the appropriate line in the file.</p>

<p>If you manually look at the files, you may notice that there are similar lines, replacing the &ldquo;AIC&rdquo; part with &ldquo;BIC&rdquo;. We can ignore
those. If you look at this line, we can see that the part we need to extract is after the string
(pattern) &ldquo;AIC: &ldquo;.  To get this model, we need to first extract the line from the file with <code>grep</code>
and then remove the &ldquo;The best model &hellip;. AIC:&rdquo; part. Two tasks:</p>

<ol>
<li>Extract the line containing &ldquo;The best model &hellip;. &rdquo; from the 100.mod file and assign it to a
variable named <code>MODELLINE</code></li>
<li>Remove everyting in the line preceding the model part and assign this to <code>MODEL</code></li>
</ol>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
    	
    	Show me
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <pre><code class="language-bash">#Make sure you are in the &quot;model&quot; directory
MODELLINE=$(grep &quot;The best model according to AIC&quot; 100.mod)
MODEL=${MODELLINE#*AIC: } # Don't need the entire string, we know there is only one instance of
&quot;AIC: &quot;
</code></pre>

    </div>
</div>

<p>Great! Now, let&rsquo;s manually assign the value &ldquo;100.mod&rdquo; to the variable <code>MODELFILENAME</code>.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
    	
    	Show me
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <pre><code class="language-bash">MODELFILENAME=&quot;100.mod&quot; # or: MODELFILENAME=100.mod 
</code></pre>

    </div>
</div>

<p>We need to concatenate (join) these variables using a comma as a separator.  You can look at the
previous sections to see how to join values of variables together. Assing the variable <code>OUTPUT</code> to
this concatenated value <em>or</em> use <code>echo</code> to print it out.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
    	
    	Show me
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <pre><code class="language-bash"># Assign to variable
OUTPUT=${MODELFILENAME},${MODEL}

echo ${OUTPUT}

#or

echo &quot;${MODELFILENAME},${MODEL}&quot;
</code></pre>

    </div>
</div>

<!-- ### Getting a little more fancy

We're going to jump ahead a bit.  Let's make a simple bash script that will tell us the sizes of all
the FASTA files.  This may be a little daunting, but I aim to show you how to break down a seemingly
complicated problem.  Before going head first into this problem, you need to ask what do you want?
By now you should be familiar with CSV files.  Kinda like a spreadsheet with the cells in the rows
separated by a comma. May I want the output to look like this: 


```csv
Seq1, 2000
Seq2, 50000
Seq3, 500
```

OK, great. We know the end goal.  Now we have to ask ourselves: what does a FASTA file look like?


-->


<footer class=" footline" >
	
</footer>


        
        </div> 
      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/bifgeneralguides/bash/" title="Bashes"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/bifgeneralguides/bash/_intro/" title="BASH" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/bifgeneralguides/js/clipboard.min.js?1509465003"></script>
    <script src="/bifgeneralguides/js/perfect-scrollbar.min.js?1509465003"></script>
    <script src="/bifgeneralguides/js/perfect-scrollbar.jquery.min.js?1509465003"></script>
    <script src="/bifgeneralguides/js/jquery.sticky-kit.min.js?1509465003"></script>
    <script src="/bifgeneralguides/js/featherlight.min.js?1509465003"></script>
    <script src="/bifgeneralguides/js/html5shiv-printshiv.min.js?1509465003"></script>
    <script src="/bifgeneralguides/js/highlight.pack.js?1509465003"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/bifgeneralguides/js/modernizr.custom.71422.js?1509465003"></script>
    <script src="/bifgeneralguides/js/learn.js?1509465003"></script>
    <script src="/bifgeneralguides/js/hugo-learn.js?1509465003"></script>

    <link href="/bifgeneralguides/mermaid/mermaid.css?1509465003" type="text/css" rel="stylesheet" />
    <script src="/bifgeneralguides/mermaid/mermaid.js?1509465003"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

